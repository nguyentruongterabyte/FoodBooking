<!-- login.html -->
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<title>Login Page</title>

	<!-- Script -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="/assets/library/jquery-3.7.1.min.js"></script>
	<script src="/assets/library/my-toast/notification.js"></script>
	<script src="/javascript/common.js"></script>
	<script src="/javascript/ajaxService.js"></script>
	<script src="/javascript/login.js"></script>

	<!-- Style -->
	<link rel="stylesheet" href="/css/globalStyles.css" />
	<link rel="stylesheet" href="/css/login.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
		integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/assets/library/my-toast/notification.css">

</head>

<body>
	<form id="login-form" class="form" action="/perform-login" method="post" autocomplete="off">
		<div id="login-error" style="color: red; display: none;">Bad Credentials!</div>
		<div class="form-label">
			<h1>Login</h1>
		</div>
		<div class="form-group">
			<label for="username">Enter your Account</label>
			<div class="control">
				<i class="fa-regular fa-user"></i>
				<input id="username" name="username" placeholder="Your Account" type="text" autocomplete="off" />
			</div>
			<div class="invalid-feedback username">Please input account</div>
		</div>
		<div class="form-group">
			<label for="password">Enter your Password</label>
			<div class="control">
				<i class="fa-solid fa-key"></i>
				<input id="password" name="password" placeholder="Your Password" type="password"
					autocomplete="new-password" />
			</div>
			<div class="invalid-feedback password">Please input password</div>
		</div>
		<button class="btn" type="submit">
			<div class="text">Log In</div>
		</button>
		<div class="line"></div>
		<div class="social-login">
			<h3>log in via</h3>
			<div class="social-icons">
				<a href="#" id="google-btn" class="social-login__icon fab fa-google"></a>
				<a href="#" class="social-login__icon fab fa-instagram"></a>
				<a href="#" class="social-login__icon fab fa-facebook"></a>
			</div>
		</div>
	</form>
	<script>
		// Hiện thông báo lỗi nếu URL có ?error=true
		const params = new URLSearchParams(window.location.search);
		if (params.has('error')) {
			document.getElementById('login-error').style.display = 'block';
		}
	</script>
	<script type="module">
		import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
		import { getAuth, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

		const firebaseConfig = {
			apiKey: "AIzaSyCbDPhhgDmWgXa-uQGlz_nuU6jA18bLeEk",
			authDomain: "hatshop-bc917.firebaseapp.com",
			projectId: "hatshop-bc917",
			storageBucket: "hatshop-bc917.appspot.com",
			messagingSenderId: "92221996857",
			appId: "1:92221996857:web:b843c31bb1ed20795172e8",
		};

		const app = initializeApp(firebaseConfig);
		const auth = getAuth(app);
		const provider = new GoogleAuthProvider();
		
		$('#google-btn').on('click', function() {
				signInWithPopup(auth, provider)
					.then(async (result) => {
						const idToken = await result.user.getIdToken();
						
						const response = await fetch('/api/accounts/firebase-auth', {
							method: 'POST',
							headers: {
								'Content-Type': 'application/json'
							},
							body: JSON.stringify({idToken})
						});
						
						if (response.ok) {
							window.location.assign('/');
						} else {
							console.error('Failed authentication!');
						}
					})
					.catch((error) => {
						console.error("Error login:", error);
					});
		});
	</script>
</body>

</html>